<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>TTF with embedded bitmaps | Typophile Archive</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.91.2" />
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <meta property="og:title" content="TTF with embedded bitmaps" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://typophile.github.io/node/55053/" /><meta property="article:section" content="node" />
<meta property="article:published_time" content="2009-02-20T23:16:01+00:00" />
<meta property="article:modified_time" content="2009-02-20T23:16:01+00:00" />

<meta itemprop="name" content="TTF with embedded bitmaps">
<meta itemprop="description" content=""><meta itemprop="datePublished" content="2009-02-20T23:16:01+00:00" />
<meta itemprop="dateModified" content="2009-02-20T23:16:01+00:00" />
<meta itemprop="wordCount" content="0">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="TTF with embedded bitmaps"/>
<meta name="twitter:description" content=""/>

  </head>

  <body class="ma0 avenir bg-near-white">

      <header>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/">Typophile Archive</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>
</header>
 
    <main class="pb7" role="main">
      
<article class="container">
  <header class="post-header py-3">
    <h1 class="post-title p-name" itemprop="name headline">TTF with embedded bitmaps</h1>
    <p class="text-muted">
              
      <time class="f6 mv4 dib tracked" datetime="2009-02-20T23:16:01Z">February 20, 2009</time>
      
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Mark Simonson</span></span>
      

    </p>
  </header>
  <div class="post-content e-content" itemprop="articleBody"><p>(I&rsquo;ve posted a question about this on the FontLab forum, but haven&rsquo;t gotten a response after several days, so I&rsquo;m trying here.)</p>
<p>I&rsquo;m building a new version of one of my old fonts, Anonymous. It&rsquo;s a TTF fixed-width font (meant for programmers) and I&rsquo;d like to include bitmaps for certain PPMs (10, 11, 12, 13). I created the bitmaps with BitFonter and successfully imported them into the FontLab file.</p>
<p>The generated font works great in most OS X apps I&rsquo;ve tested (including Terminal, Coda, TextEdit, PhotoShop CS4, Illustrator CS4, Mail) using whatever method is available to disable anti-aliasing. (In some apps, such as Quark 8, it&rsquo;s not possible to disable anti-aliasing, but the font still works.) It also seems to work fine in Windows (XP) in the limited testing I&rsquo;ve done there. The font validates in Apple Font Book. I got some errors in MS Font Validator, but I was able to eliminate them.</p>
<p>Nevertheless, this font causes BBEdit, one of the most popular Mac programmers' text editors, to crash, whether antialiasing is enabled or not. The only way the font can be used without crashing BBEdit is to generate it without the bitmaps. I&rsquo;ve also found one app, TexEdit, a simple shareware text editor, will not display the font at any of the sizes that have bitmaps&ndash;the characters become invisible at those sizes. The app doesn&rsquo;t crash, though. There may be other apps that are affected, but these are the only two I&rsquo;ve found so far.</p>
<p>In the old version of the font, which I built years ago with Fontographer, I was only able to include the bitmaps in the Mac version (as a font suitcase). This version works flawlessly with BBEdit, so it&rsquo;s not that BBEdit can&rsquo;t display embedded bitmap fonts at all. Thinking it might be something to do with Mac vs. PC TTF, I tried generating a Mac suitcase-based TrueType file from FontLab, but this, too, causes BBEdit to crash. I tried importing the new version of the font into Fontographer (OS X version) and generated a Mac suitcase-based TrueType font. This doesn&rsquo;t cause BBEdit to crash, but Fontographer would only include the first 256 bitmap characters. I also tried limiting the number of bitmap characters in FontLab, but this still caused BBEdit to crash.</p>
<p>I&rsquo;ve been unable to find much information about embedding bitmaps in TTF files (the FontLab manual has very little to say about it). I have assumed that I&rsquo;m doing something wrong, but I&rsquo;ve spent several days trying different things with no success. Has anyone else successfully built TTFs with embedded bitmaps using FontLab? Could this be a FontLab bug? If it&rsquo;s a bug in BBEdit, why would it work if the font is generated by Fontographer, but not if it&rsquo;s generated by FontLab? Any advice or information is welcome.</p>
<p>(I realize I could manually hint the font, optimized for the PPMs in question, using my bitmaps as a guide, but it would be much simpler and faster if I could get the bitmap embedding to work, as I already have all the bitmaps created. The new version of the font has over 600 glyphs x 2 weights x 4 PPMs, so doing manual hinting would add a huge amount of extra work to the project.)</p>
</div>

   <div class="comment card m-3">
	<div class="card-body">
		<div class="commentbody"><p>Ah ha! I think this might be a bug in FontLab.</p>
<p>When I opened the font in BitFonter, I noticed something weird:</p>
<p><img src="/images/old-images/bffontinfowindow_5737.jpg" alt=""></p>
<p>Note how all the metrics values are &ldquo;0&rdquo;. I didn&rsquo;t think this was necessarily a problem when I first notice this. After all, I put the bitmaps into the font and FontLab should know what to do with them. If it puts in zeros, then it must be okay.</p>
<p>Today, I was looking at the crash reports from BBEdit and they were always the same: a &ldquo;divide by zero&rdquo; error, apparently (judging from the function calls in the crash report) when it was calculating the dimensions of the text. This made me suspicious of those zeros.</p>
<p>Just as a test, I opened the TTF in BitFonter and filled in the correct metrics data, and then saved the font (from BitFonter) as a TTF. Bingo: BBEdit does not crash anymore and the font displays the embedded bitmaps as expected.</p>
<p>I would deduce from this that the bitmap metrics data isn&rsquo;t always required by apps, but when it is missing can cause problems in some cases. Since this data is sometimes required, I would count it as a bug FontLab.</p>
<p>(My workaround has led to one bad side effect: When anti-aliasing is disabled, sizes that don&rsquo;t have embedded bitmaps have erratic spacing. I think I can probably fix it, though.)</p>
</div>
	</div>
	<div class="card-footer text-muted post-meta text-end">
		<time
			class="dt-published"
			datetime="2009-02-21 02:40:30"
			itemprop="datePublished"
		>
			2009-02-21 02:40:30
		</time>
		•
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span class="p-author h-card" itemprop="name"
				>Mark Simonson</span
			></span
		>
	</div>
	
</div>
  <div class="comment card m-3">
	<div class="card-body">
		<div class="commentbody"><p>Mark, thanks for sharing this.</p>
<p>In terms of assigning blame, it usually takes two to tango. Yes FontLab* might be doing something wrong, but BBEdit&rsquo;s crashing is only its own fault; for one thing other programs apparently handled FontLab&rsquo;s output just fine. Although you&rsquo;ve nicely resolved this, it&rsquo;s probably worth pointing both the FontLab and BBEdit folks to this thread.</p>
<ul>
<li>In fact as I was reading your first post I was thinking &ldquo;use BitFonter, not FontLab, for the final font file generation&rdquo;.</li>
</ul>
<p>&ndash;</p>
<p>BTW, could you do me a huge favor and see if you have success with grayscale bitmaps? Only if you have the time. I was a BitFonter beta tester ages ago, but I&rsquo;ve held off getting the release version because the beta didn&rsquo;t embed grayscales properly and I never got a fully comforting answer about the release version managing it.</p>
<p>hhp</p>
</div>
	</div>
	<div class="card-footer text-muted post-meta text-end">
		<time
			class="dt-published"
			datetime="2009-02-21 05:38:13"
			itemprop="datePublished"
		>
			2009-02-21 05:38:13
		</time>
		•
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span class="p-author h-card" itemprop="name"
				>hrant</span
			></span
		>
	</div>
	
</div>
  <div class="comment card m-3">
	<div class="card-body">
		<div class="commentbody"><p>I think the problem may be with Carbon apps on OS X. Carbon allows developers to use the pre-OS X APIs so they wouldn’t need to rewrite their apps from scratch to get them to work on OS X. These are less common now, but they still are around. If it is a Carbon problem, it’s not likely to get fixed since Apple has stopped development on it. Mac OS X still supports Carbon, but it’s essentially frozen.</p>
<p>Mac OS 9 and earlier did not support the .ttf (Windows TrueType) format. To embed bitmaps in a Mac TT (sfnt) font, you just needed to make NFNT font resources with the appropriate name and resource data, and bundle them into the same suitcase file with the sfnt. The bitmaps are separate and associated with the sfnt, but not embedded tables in the sfnt. NFNT bitmaps include their own metrics data. Apparently, this data is not required for .ttf fonts with embedded bitmaps, perhaps because the necessary data already exists elsewhere in the TT tables.</p>
<p>Yet, if I generate a Mac font suitcase from the same FontLab file, the metrics data is also missing (actually, not missing, but zeroed out). This cannot possibly be right, and would explain the behavior of certain apps which appear to expect it to be there. And, predictably, it crashes BBEdit. It may well be that Carbon should be synthesizing the bitmap metrics data if it’s missing for Carbon apps that need it, and that seems to be the likely culprit with regard to .ttf fonts with embedded bitmaps. But FontLab should also be including this data when it generates a Mac suitcase-based TT font, but it’s not. Adding the appropriate bitmap metrics to the .ttf appears to fix the problem without breaking anything else. I’m still testing, but so far, so good.</p>
<p>Incidentally, I managed to fix the spacing problem I mentioned at the end of my previous post. Not sure how exactly because I was changing too many variables simultaneously, but I now have a repeatable recipe that (seems to) work.</p>
<p>I haven&rsquo;t tried embedding grayscale fonts with BitFonter, so I don&rsquo;t know if that works or not.</p>
<p>(This message and my previous one have been cross-posted to the FontLab forum.)</p>
</div>
	</div>
	<div class="card-footer text-muted post-meta text-end">
		<time
			class="dt-published"
			datetime="2009-02-21 15:48:44"
			itemprop="datePublished"
		>
			2009-02-21 15:48:44
		</time>
		•
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span class="p-author h-card" itemprop="name"
				>Mark Simonson</span
			></span
		>
	</div>
	
</div>
  <div class="comment card m-3">
	<div class="card-body">
		<div class="commentbody"><p>Incidentally, Hrant, the regarding &ldquo;use BitFonter, not FontLab, for the final font file generation&rdquo;, BitFonter (as far as I know) does not touch any of the non-bitmap-related TT tables, just the bitmap-related ones. Most of the tables are built by FontLab, and BitFonter is only modifying the bitmap-related ones when I add the metrics data (as far as I can tell).</p>
<p>Also, I tried embedding the bitmaps using BitFonter, but I couldn&rsquo;t get that to work at all. Maybe I was doing it wrong.</p>
</div>
	</div>
	<div class="card-footer text-muted post-meta text-end">
		<time
			class="dt-published"
			datetime="2009-02-21 15:55:19"
			itemprop="datePublished"
		>
			2009-02-21 15:55:19
		</time>
		•
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span class="p-author h-card" itemprop="name"
				>Mark Simonson</span
			></span
		>
	</div>
	
</div>
  <div class="comment card m-3">
	<div class="card-body">
		<div class="commentbody"><p>Mark:</p>
<p>Carbon apps may be &ldquo;less common,&rdquo; but they include a lot of major apps people care about. Microsoft Office. Adobe Creative Suite. etcetera.</p>
<p>Cheers,</p>
<p>T</p>
</div>
	</div>
	<div class="card-footer text-muted post-meta text-end">
		<time
			class="dt-published"
			datetime="2009-02-22 04:55:19"
			itemprop="datePublished"
		>
			2009-02-22 04:55:19
		</time>
		•
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span class="p-author h-card" itemprop="name"
				>Thomas Phinney</span
			></span
		>
	</div>
	
</div>
  <div class="comment card m-3">
	<div class="card-body">
		<div class="commentbody">Exactly. Which is why I was concerned. Although, CS apps seem not to be affected. In fact, one of the apps that is affected by the missing metrics data is MS Word (Mac). It doesn&rsquo;t crash, but the text disappears.</div>
	</div>
	<div class="card-footer text-muted post-meta text-end">
		<time
			class="dt-published"
			datetime="2009-02-22 06:22:01"
			itemprop="datePublished"
		>
			2009-02-22 06:22:01
		</time>
		•
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<span class="p-author h-card" itemprop="name"
				>Mark Simonson</span
			></span
		>
	</div>
	
</div>
 
</article>

    </main>
    
  </body>
</html>
